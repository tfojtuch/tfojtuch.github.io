<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}</style><title data-react-helmet="true">Error handling with Apollo Client | Tomek&#x27;s blog</title><link rel="icon" href="/blog/icons/icon-48x48.png?v=5df4236cc5a55518734fb9d63ac8c975"/><link rel="manifest" href="/blog/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png?v=5df4236cc5a55518734fb9d63ac8c975"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png?v=5df4236cc5a55518734fb9d63ac8c975"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png?v=5df4236cc5a55518734fb9d63ac8c975"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png?v=5df4236cc5a55518734fb9d63ac8c975"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png?v=5df4236cc5a55518734fb9d63ac8c975"/><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png?v=5df4236cc5a55518734fb9d63ac8c975"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png?v=5df4236cc5a55518734fb9d63ac8c975"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png?v=5df4236cc5a55518734fb9d63ac8c975"/><meta name="generator" content="Gatsby 2.19.16"/><meta data-react-helmet="true" content="In continuation of previous post dedicated to server-side error handling, in this post let’s focus on error handling in a react application with Apollo Client…" name="description"/><meta data-react-helmet="true" content="Error handling with Apollo Client" property="og:title"/><meta data-react-helmet="true" content="In continuation of previous post dedicated to server-side error handling, in this post let’s focus on error handling in a react application with Apollo Client…" property="og:description"/><meta data-react-helmet="true" content="website" property="og:type"/><style data-href="/blog/styles.b2faaa3cebe5d9ff4bd2.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/blog/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/blog/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/blog/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/blog/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/blog/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/blog/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/blog/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/blog/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/blog/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/blog/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/blog/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/blog/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/blog/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/blog/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/blog/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/blog/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/blog/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/blog/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/blog/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/blog/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/blog/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/blog/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/blog/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/blog/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/blog/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/blog/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/blog/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/blog/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/blog/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/blog/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/blog/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/blog/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/blog/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/blog/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/blog/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/blog/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/blog/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/blog/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/blog/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/blog/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/blog/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/blog/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/blog/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/blog/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/blog/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/blog/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/blog/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/blog/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/blog/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/blog/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/blog/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/blog/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}.grvsc-container-additional{border:1px solid rgba(0,0,0,.1)}ol,ul{padding-left:32px;text-align:left}</style><style data-styled="" data-styled-version="5.0.1">.hnNsNg{font-family:Montserrat,sans-serif;margin-top:0;}
data-styled.g1[id="layout__StyledH2-cejxee-0"]{content:"hnNsNg,"}
.dvOsTf{box-shadow:none;color:inherit;-webkit-text-decoration:none;text-decoration:none;}
data-styled.g2[id="layout__StyledLink-cejxee-1"]{content:"dvOsTf,"}
.kEKHUO{margin-left:auto;margin-right:auto;max-width:43.75rem;padding:2.625rem 1.3125rem;}
data-styled.g3[id="layout__Content-cejxee-2"]{content:"kEKHUO,"}
.bIuYxM{display:block;font-size:0.83255rem;line-height:1.75rem;margin-bottom:1.75rem;margin-top:-1.75rem;}
data-styled.g4[id="blog-post__Date-eho2rb-0"]{content:"bIuYxM,"}
.jvjEUU{margin-bottom:1.75rem;}
data-styled.g5[id="blog-post__Divider-eho2rb-1"]{content:"jvjEUU,"}
.kmhqYf{text-align:justify;}
data-styled.g6[id="blog-post__Content-eho2rb-2"]{content:"kmhqYf,"}
.dHdzzE{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;list-style:none;padding:0;}
data-styled.g7[id="blog-post__PostNavigator-eho2rb-3"]{content:"dHdzzE,"}
</style><link as="script" rel="preload" href="/blog/component---src-templates-blog-post-tsx-52cdd10a98d92531f1e9.js"/><link as="script" rel="preload" href="/blog/commons-4c5a16b1316207ebaf0f.js"/><link as="script" rel="preload" href="/blog/app-8ed3204e5c27ae2d5728.js"/><link as="script" rel="preload" href="/blog/styles-e4a06a68ee395de1b9be.js"/><link as="script" rel="preload" href="/blog/webpack-runtime-c97ca491c02a36b48a90.js"/><link as="fetch" rel="preload" href="/blog/page-data\error-handling-with-apollo-client\page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout__Content-cejxee-2 kEKHUO"><header><h2 class="layout__StyledH2-cejxee-0 hnNsNg"><a class="layout__StyledLink-cejxee-1 dvOsTf" href="/blog/">Tomek&#x27;s blog</a></h2></header><main><h1>Error handling with Apollo Client</h1><p class="blog-post__Date-eho2rb-0 bIuYxM">February 08, 2020</p><div class="blog-post__Content-eho2rb-2 kmhqYf"><p>In continuation of <a href="/blog/error-handling-with-apollo-server/">previous post</a> dedicated to server-side error handling, in this post let’s focus on error handling in a react application with Apollo Client. In such an application we can experience errors related to GraphQL response as well as other, non-GraphQL-related errors in UI or internal logic - those will be covered in the last section. </p>
<p>GraphQL-related errors can be accessed in an application through <a href="https://github.com/apollographql/apollo-client/blob/master/src/errors/ApolloError.ts">ApolloError</a> object containing fields:</p>
<ul>
<li><em>networkError</em> - when no response was obtained</li>
<li><em>graphQLErrors</em> array - contains errors returned by server</li>
<li><em>message</em> - error message, by default concatenated from error messages of <em>networkError</em> and <em>graphQLErrors</em></li>
<li><em>extraInfo</em> - used internally by Apollo Client</li>
</ul>
<p>Apollo Client’s capabilities that we can use for error handling are described in Apollo’s <a href="https://www.apollographql.com/docs/react/data/error-handling/">documentation</a> and
<a href="https://blog.apollographql.com/full-stack-error-handling-with-graphql-apollo-5c12da407210">blog</a>. Let’s shortly summarize what capabilities we have at hand. As every GraphQL response can contain both <em>data</em> and <em>errors</em>, for every query or mutation individual <a href="https://www.apollographql.com/docs/react/data/error-handling/#error-policies">errorPolicy</a> can be set. This setting allows to ignore <em>data</em>, ignore <em>errors</em> or retain both on a response. When errors are not ignored they can be handled either globally by providing a global handler or locally on component level using one of two options:</p>
<ul>
<li><em>error</em> object returned from <em>useQuery</em>/<em>useMutation</em></li>
<li>an error handler provided to <em>onError</em> property of <em>useQuery’s</em>/<em>useMutation’s</em> configuration object</li>
</ul>
<p>Which option to choose depends on what result we want to achieve:</p>
<ul>
<li>When we want to change internal state of a component then we have to use <em>onError</em> callback. Otherwise, when we try to change state outside of a handler we’ll get the following error from React: “Error: Too many re-renders. React limits the number of renders to prevent an infinite loop.”.</li>
<li>When we want to display a custom component we should use <em>error</em> object, since there is no way to return a component from <em>onError</em> handler.</li>
</ul>
<p>In short, for imperative code we should use <em>onError</em> handler and for declarative code we should use <em>error</em> object. In the next section let’s cover how GraphQL errors can be handled using <em>onError</em> handlers.</p>
<h2>1. Handling GraphQL errors imperatively</h2>
<p>Errors can be handled either globally or locally on component level. First let’s cover global handling. A global handler can be set either with use of <a href="https://www.apollographql.com/docs/link/links/error/">apollo-link-error</a> or with Apollo Boost by directly using <em>onError</em> property:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk14">export</span><span class="mtk1"> </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">client</span><span class="mtk1"> = </span><span class="mtk4">new</span><span class="mtk1"> </span><span class="mtk9">ApolloClient</span><span class="mtk1">({</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">onError</span><span class="mtk12">:</span><span class="mtk1"> ({ </span><span class="mtk12">operation</span><span class="mtk1">, </span><span class="mtk12">response</span><span class="mtk1">, </span><span class="mtk12">graphQLErrors</span><span class="mtk1">, </span><span class="mtk12">networkError</span><span class="mtk1"> }) </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk3">// here errors can be handled globally</span></span>
<span class="grvsc-line"><span class="mtk1">  },</span></span>
<span class="grvsc-line"><span class="mtk1">});</span></span></code></pre>
<p>How the global handler is used depends on project’s requirements and may include changing global state, remote logging, refreshing authentication tokens after receiving error with <em>UNAUTHENTICATED</em> code etc.</p>
<p>An error can be also handled on component level via <em>onError</em> property of <em>useQuery’s</em>/<em>useMutation’s</em> configuration object. Continuing example from <a href="/blog/error-handling-with-apollo-server/">previous post</a> let’s see how error handling could look like in <em>UpdateUserEmail</em> component. First let’s a build custom hook <em>useUpdateUserEmailMutation</em>. For type safety - like on server side - we also use types generated by <a href="https://github.com/dotansimha/graphql-code-generator">graphql code generator</a> :</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk14">import</span><span class="mtk1"> { </span><span class="mtk12">useMutation</span><span class="mtk1">, </span><span class="mtk12">MutationHookOptions</span><span class="mtk1"> } </span><span class="mtk14">from</span><span class="mtk1"> </span><span class="mtk17">&quot;@apollo/react-hooks&quot;</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk14">import</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">UpdateUserEmailMutation</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">UpdateUserEmailMutationVariables</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">} </span><span class="mtk14">from</span><span class="mtk1"> </span><span class="mtk17">&quot;graphql/generated&quot;</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk14">import</span><span class="mtk1"> { </span><span class="mtk12">UPDATE_USER_EMAIL</span><span class="mtk1"> } </span><span class="mtk14">from</span><span class="mtk1"> </span><span class="mtk17">&quot;graphql/operations/user&quot;</span><span class="mtk1">;</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk14">export</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">useUpdateUserEmailMutation</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">options</span><span class="mtk1">?: </span><span class="mtk9">MutationHookOptions</span><span class="mtk1">&lt;</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk9">UpdateUserEmailMutation</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk9">UpdateUserEmailMutationVariables</span></span>
<span class="grvsc-line"><span class="mtk1">  &gt;,</span></span>
<span class="grvsc-line"><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk10">useMutation</span><span class="mtk1">&lt;</span><span class="mtk9">UpdateUserEmailMutation</span><span class="mtk1">, </span><span class="mtk9">UpdateUserEmailMutationVariables</span><span class="mtk1">&gt;(</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk12">UPDATE_USER_EMAIL</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk12">options</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  );</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span></code></pre>
<p>Next we import the hook into <em>UpdateUserEmail</em> component and use it:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> [</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk12">updateUserEmail</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">    { </span><span class="mtk12">data</span><span class="mtk1">, </span><span class="mtk12">loading</span><span class="mtk1">, </span><span class="mtk12">error</span><span class="mtk1"> },</span></span>
<span class="grvsc-line"><span class="mtk1">  ] = </span><span class="mtk10">useUpdateUserEmailMutation</span><span class="mtk1">({</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk12">onError:</span><span class="mtk1"> </span><span class="mtk12">handleErrors</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  });</span></span></code></pre>
<p>Now we have to create <em>handleErrors</em> function, but first let’s recall what kind of errors we have to cover. <em>updateUserEmailResolver</em> could send us <em>UserInputError</em> with <em>properties</em> object containing <em>operation</em> property set to <em>UPDATE_USER_EMAIL</em> and <em>codes</em> property set to <em>EMAIL_EXISTS</em> or <em>INVALID_PASSWORD</em>. Our <em>handleErrors</em> function will have to cover these two cases, so let’s first write error handlers covering each of them. To not have to remember string literals representing error codes lets use <em>UserInputErrorCode</em> that we were using on server side and excluded to a separate, common package:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk14">export</span><span class="mtk1"> </span><span class="mtk4">enum</span><span class="mtk1"> </span><span class="mtk9">UserInputErrorCode</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">EmailExists</span><span class="mtk1"> = </span><span class="mtk17">&quot;EMAIL_EXISTS&quot;</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">InvalidCredentials</span><span class="mtk1"> = </span><span class="mtk17">&quot;INVALID_CREDENTIALS&quot;</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">InvalidPassword</span><span class="mtk1"> = </span><span class="mtk17">&quot;INVALID_PASSWORD&quot;</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span></code></pre>
<p>Using it we can build error handlers, here is an example with <a href="https://github.com/react-hook-form/react-hook-form">react-hook-form</a> used for form handling and <a href="https://github.com/formatjs/react-intl">react-intl</a> used for i18n:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="4"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">handleEmailExistsError</span><span class="mtk1">(): </span><span class="mtk9">void</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">emailErrorMessage</span><span class="mtk1"> = </span><span class="mtk12">intl</span><span class="mtk1">.</span><span class="mtk10">formatMessage</span><span class="mtk1">({</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk12">id:</span><span class="mtk1"> </span><span class="mtk17">&quot;EmailTextFieldErrorId&quot;</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">    });</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">setError</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk17">&quot;emailTextFieldName&quot;</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk12">UserInputErrorCode</span><span class="mtk1">.</span><span class="mtk12">EmailExists</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk12">emailErrorMessage</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">    );</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">handleInvalidPasswordError</span><span class="mtk1">(): </span><span class="mtk9">void</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">passwordErrorMessage</span><span class="mtk1"> = </span><span class="mtk12">intl</span><span class="mtk1">.</span><span class="mtk10">formatMessage</span><span class="mtk1">({</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk12">id:</span><span class="mtk1"> </span><span class="mtk17">&quot;CurrentPasswordTextFieldErrorId&quot;</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">    });</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk10">setError</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk17">&quot;currentPasswordTextFieldName&quot;</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk12">UserInputErrorCode</span><span class="mtk1">.</span><span class="mtk12">InvalidPassword</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk12">passwordErrorMessage</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">    );</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span></code></pre>
<p>Next we can use these handlers to build <em>handleErrors</em> function:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="5"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">handleErrors</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">: </span><span class="mtk9">ApolloError</span><span class="mtk1">): </span><span class="mtk9">void</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">if</span><span class="mtk1"> (</span><span class="mtk10">canHandleErrors</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">, </span><span class="mtk12">errorProperties</span><span class="mtk1">)) {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">handlers</span><span class="mtk1"> = {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk12">[UserInputErrorCode.EmailExists]:</span><span class="mtk1"> </span><span class="mtk12">handleEmailExistsError</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk12">[UserInputErrorCode.InvalidPassword]:</span><span class="mtk1"> </span><span class="mtk12">handleInvalidPasswordError</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">      };</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk10">handleUserInputErrors</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">, </span><span class="mtk12">handlers</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span></code></pre>
<p>Let’s analyze what the function does. It receives an error of type <em>ApolloError</em>, the error can contain <em>networkError</em> and/or <em>graphQLErrors</em> array. First, using <em>canHandleErrors</em> function, we check if the handler can properly handle all received errors. If the function returns <em>true</em> then <em>handlers</em> object is being built and passed to <em>handleUserInputErrors</em> function. <em>canHandleErrors</em> function receives <em>error</em> and <em>errorProperties</em> object that conveys information what error properties this UI can handle. To build <em>errorProperties</em> object we have to recall from previous post what shape it has for <em>UPDATE_USER_EMAIL</em> operation:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="6"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk14">export</span><span class="mtk1"> </span><span class="mtk4">enum</span><span class="mtk1"> </span><span class="mtk9">UserInputOperation</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">AddUser</span><span class="mtk1"> = </span><span class="mtk17">&quot;ADD_USER&quot;</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">SighIn</span><span class="mtk1"> = </span><span class="mtk17">&quot;SIGN_IN&quot;</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">UpdateUserEmail</span><span class="mtk1"> = </span><span class="mtk17">&quot;UPDATE_USER_EMAIL&quot;</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk4">interface</span><span class="mtk1"> </span><span class="mtk9">ErrorProperties</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">operation</span><span class="mtk1">: </span><span class="mtk9">UserInputOperation</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">codes</span><span class="mtk1">: </span><span class="mtk9">Array</span><span class="mtk1">&lt;</span><span class="mtk9">UserInputErrorCode</span><span class="mtk1">&gt;;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk4">interface</span><span class="mtk1"> </span><span class="mtk9">AddUserErrorProperties</span><span class="mtk1"> </span><span class="mtk4">extends</span><span class="mtk1"> </span><span class="mtk9">ErrorProperties</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">operation</span><span class="mtk1">: </span><span class="mtk9">UserInputOperation</span><span class="mtk1">.</span><span class="mtk9">AddUser</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">codes</span><span class="mtk1">: </span><span class="mtk9">Array</span><span class="mtk1">&lt;</span><span class="mtk9">UserInputErrorCode</span><span class="mtk1">.</span><span class="mtk9">EmailExists</span><span class="mtk1">&gt;;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk4">interface</span><span class="mtk1"> </span><span class="mtk9">SignInErrorProperties</span><span class="mtk1"> </span><span class="mtk4">extends</span><span class="mtk1"> </span><span class="mtk9">ErrorProperties</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">operation</span><span class="mtk1">: </span><span class="mtk9">UserInputOperation</span><span class="mtk1">.</span><span class="mtk9">SighIn</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">codes</span><span class="mtk1">: </span><span class="mtk9">Array</span><span class="mtk1">&lt;</span><span class="mtk9">UserInputErrorCode</span><span class="mtk1">.</span><span class="mtk9">InvalidCredentials</span><span class="mtk1">&gt;;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk4">interface</span><span class="mtk1"> </span><span class="mtk9">UpdateUserEmailErrorProperties</span><span class="mtk1"> </span><span class="mtk4">extends</span><span class="mtk1"> </span><span class="mtk9">ErrorProperties</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">operation</span><span class="mtk1">: </span><span class="mtk9">UserInputOperation</span><span class="mtk1">.</span><span class="mtk9">UpdateUserEmail</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">codes</span><span class="mtk1">: </span><span class="mtk9">Array</span><span class="mtk1">&lt;</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk9">UserInputErrorCode</span><span class="mtk1">.</span><span class="mtk9">EmailExists</span><span class="mtk1"> | </span><span class="mtk9">UserInputErrorCode</span><span class="mtk1">.</span><span class="mtk9">InvalidPassword</span></span>
<span class="grvsc-line"><span class="mtk1">  &gt;;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk14">export</span><span class="mtk1"> </span><span class="mtk4">type</span><span class="mtk1"> </span><span class="mtk9">UserInputErrorProperties</span><span class="mtk1"> =</span></span>
<span class="grvsc-line"><span class="mtk1">  | </span><span class="mtk9">AddUserErrorProperties</span></span>
<span class="grvsc-line"><span class="mtk1">  | </span><span class="mtk9">SignInErrorProperties</span></span>
<span class="grvsc-line"><span class="mtk1">  | </span><span class="mtk9">UpdateUserEmailErrorProperties</span><span class="mtk1">;</span></span></code></pre>
<p>The above code was also excluded to the common project so we can use <em>UserInputErrorProperties</em> <a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#discriminated-unions">discriminated union</a> along with <a href="https://www.typescriptlang.org/docs/handbook/enums.html#string-enums">string enums</a> <em>UserInputOperation</em> and <em>UserInputErrorCode</em> to build <em>errorProperties</em> object:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="7"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk3">// This UI can gracefully handle UserInputErrors with the following properties:</span></span>
<span class="grvsc-line"><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">errorProperties</span><span class="mtk1">: </span><span class="mtk9">UserInputErrorProperties</span><span class="mtk1"> = {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">operation:</span><span class="mtk1"> </span><span class="mtk12">UserInputOperation</span><span class="mtk1">.</span><span class="mtk12">UpdateUserEmail</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">codes:</span><span class="mtk1"> [</span><span class="mtk12">UserInputErrorCode</span><span class="mtk1">.</span><span class="mtk12">InvalidPassword</span><span class="mtk1">, </span><span class="mtk12">UserInputErrorCode</span><span class="mtk1">.</span><span class="mtk12">EmailExists</span><span class="mtk1">],</span></span>
<span class="grvsc-line"><span class="mtk1">};</span></span></code></pre>
<p>Now we can pass the object to <em>canHandleErrors</em> function. This function contains logic common for all components so it can be excluded to a separate module along with all helper functions it uses:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="8"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">isUserInputError</span><span class="mtk1">(</span><span class="mtk12">graphQLError</span><span class="mtk1">: </span><span class="mtk9">GraphQLError</span><span class="mtk1">): </span><span class="mtk9">boolean</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">result</span><span class="mtk1"> = </span><span class="mtk12">graphQLError</span><span class="mtk1">.</span><span class="mtk12">extensions</span><span class="mtk1">?.</span><span class="mtk12">code</span><span class="mtk1"> === </span><span class="mtk17">&quot;BAD_USER_INPUT&quot;</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">result</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">isOperationExpected</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">graphQLError</span><span class="mtk1">: </span><span class="mtk9">GraphQLError</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">expectedOperation</span><span class="mtk1">: </span><span class="mtk9">string</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">): </span><span class="mtk9">boolean</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">isExpected</span><span class="mtk1"> =</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk12">graphQLError</span><span class="mtk1">.</span><span class="mtk12">extensions</span><span class="mtk1">?.</span><span class="mtk12">exception</span><span class="mtk1">?.</span><span class="mtk12">operation</span><span class="mtk1"> === </span><span class="mtk12">expectedOperation</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">isExpected</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">getErrorCodes</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">graphQLError</span><span class="mtk1">: </span><span class="mtk9">GraphQLError</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">): </span><span class="mtk9">UserInputErrorCode</span><span class="mtk1">[] | </span><span class="mtk9">null</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">receivedErrorCodes</span><span class="mtk1"> = </span><span class="mtk12">graphQLError</span><span class="mtk1">?.</span><span class="mtk12">extensions</span><span class="mtk1">?.</span><span class="mtk12">exception</span><span class="mtk1">?.</span><span class="mtk12">codes</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">if</span><span class="mtk1"> (!</span><span class="mtk10">isUserInputErrorCodeArray</span><span class="mtk1">(</span><span class="mtk12">receivedErrorCodes</span><span class="mtk1">)) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk4">null</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">receivedErrorCodes</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">areErrorCodesExpected</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">graphQLError</span><span class="mtk1">: </span><span class="mtk9">GraphQLError</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">expectedErrorCodes</span><span class="mtk1">: </span><span class="mtk9">UserInputErrorCode</span><span class="mtk1">[],</span></span>
<span class="grvsc-line"><span class="mtk1">): </span><span class="mtk9">boolean</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">receivedErrorCodes</span><span class="mtk1"> = </span><span class="mtk10">getErrorCodes</span><span class="mtk1">(</span><span class="mtk12">graphQLError</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">if</span><span class="mtk1"> (</span><span class="mtk12">receivedErrorCodes</span><span class="mtk1"> === </span><span class="mtk4">null</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk4">false</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">areAllCodesExpected</span><span class="mtk1"> = </span><span class="mtk12">receivedErrorCodes</span><span class="mtk1">.</span><span class="mtk10">every</span><span class="mtk1">(</span><span class="mtk12">code</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">isErrorCodeExpected</span><span class="mtk1"> = </span><span class="mtk12">expectedErrorCodes</span><span class="mtk1">.</span><span class="mtk10">includes</span><span class="mtk1">(</span><span class="mtk12">code</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">isErrorCodeExpected</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  });</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">areAllCodesExpected</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">doesIncludeOnlyKnownErrors</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">error</span><span class="mtk1">: </span><span class="mtk9">ApolloError</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">knownErrorProperties</span><span class="mtk1">: </span><span class="mtk9">UserInputErrorProperties</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">): </span><span class="mtk9">boolean</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">areAllErrorsKnown</span><span class="mtk1"> = </span><span class="mtk12">error</span><span class="mtk1">.</span><span class="mtk12">graphQLErrors</span><span class="mtk1">.</span><span class="mtk10">every</span><span class="mtk1">(</span><span class="mtk12">graphQLError</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">isErrorTypeValid</span><span class="mtk1"> = </span><span class="mtk10">isUserInputError</span><span class="mtk1">(</span><span class="mtk12">graphQLError</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">isOperationValid</span><span class="mtk1"> = </span><span class="mtk10">isOperationExpected</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk12">graphQLError</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk12">knownErrorProperties</span><span class="mtk1">.</span><span class="mtk12">operation</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">    );</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">areAllErrorCodesValid</span><span class="mtk1"> = </span><span class="mtk10">areErrorCodesExpected</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk12">graphQLError</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk12">knownErrorProperties</span><span class="mtk1">.</span><span class="mtk12">codes</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">    );</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">isErrorKnown</span><span class="mtk1"> =</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk12">isErrorTypeValid</span><span class="mtk1"> && </span><span class="mtk12">isOperationValid</span><span class="mtk1"> && </span><span class="mtk12">areAllErrorCodesValid</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">isErrorKnown</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  });</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">areAllErrorsKnown</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk14">export</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">canHandleErrors</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">error</span><span class="mtk1">: </span><span class="mtk9">ApolloError</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">knownErrorProperties</span><span class="mtk1">: </span><span class="mtk9">UserInputErrorProperties</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">): </span><span class="mtk9">boolean</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">if</span><span class="mtk1"> (</span><span class="mtk12">error</span><span class="mtk1">.</span><span class="mtk12">graphQLErrors</span><span class="mtk1">.</span><span class="mtk12">length</span><span class="mtk1"> === </span><span class="mtk7">0</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk4">false</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk3">// check if all errors can be handled:</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">canHandleAllErrors</span><span class="mtk1"> = </span><span class="mtk10">doesIncludeOnlyKnownErrors</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk12">error</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk12">knownErrorProperties</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  );</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">canHandleAllErrors</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span></code></pre>
<p>Not going into details, <em>canHandleErrors</em> and its helper functions check that all received errors are of type <em>UserInputError</em> (have <em>extension.code</em>: <em>BAD_USER_INPUT</em>), have <em>operation</em> correctly set (in our example it should be <em>UPDATE_USER_EMAIL</em>) and that all error codes can be handled by this component (in our example valid error codes are <em>EMAIL_EXISTS</em> and <em>INVALID_PASSWORD</em>). If <em>canHandleErrors</em> returns <em>true</em> then errors are handled in <em>handleUserInputErrors</em> function:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="9"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk14">export</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">handleUserInputErrors</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">error</span><span class="mtk1">: </span><span class="mtk9">ApolloError</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">handlers</span><span class="mtk1">: {</span></span>
<span class="grvsc-line"><span class="mtk1">    [</span><span class="mtk12">key</span><span class="mtk1">: </span><span class="mtk9">string</span><span class="mtk1">]: () </span><span class="mtk4">=&gt;</span><span class="mtk1"> </span><span class="mtk9">void</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  },</span></span>
<span class="grvsc-line"><span class="mtk1">): </span><span class="mtk9">void</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">error</span><span class="mtk1">.</span><span class="mtk12">graphQLErrors</span><span class="mtk1">.</span><span class="mtk10">forEach</span><span class="mtk1">(</span><span class="mtk12">graphQLError</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">errorCodes</span><span class="mtk1"> = </span><span class="mtk10">getErrorCodes</span><span class="mtk1">(</span><span class="mtk12">graphQLError</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk12">errorCodes</span><span class="mtk1">?.</span><span class="mtk10">forEach</span><span class="mtk1">(</span><span class="mtk12">code</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">handler</span><span class="mtk1"> = </span><span class="mtk12">handlers</span><span class="mtk1">[</span><span class="mtk12">code</span><span class="mtk1">];</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk14">if</span><span class="mtk1"> (</span><span class="mtk12">handler</span><span class="mtk1"> !== </span><span class="mtk4">undefined</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">        </span><span class="mtk10">handler</span><span class="mtk1">();</span></span>
<span class="grvsc-line"><span class="mtk1">      }</span></span>
<span class="grvsc-line"><span class="mtk1">    });</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk3">// }</span></span>
<span class="grvsc-line"><span class="mtk1">  });</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span></code></pre>
<p>This function takes <em>handlers</em> object and invokes the appropriate handler for each received error code. For example for <em>EMAIL_EXISTS</em> <em>handleEmailExistsError</em> is invoked and assigns <em>EMAIL_EXISTS</em> to <em>emailTextFieldName</em> input. Internal state is changed and React updates UI with error message of <em>EmailTextFieldErrorId</em> id.</p>
<p>What does this setup give us? Each component has to include only those constructs that are specific to that component:</p>
<ul>
<li><em>errorProperties</em> object conveying information what errors the component can handle</li>
<li>error handlers for each error code, in our example <em>handleEmailExistsError</em> and <em>handleInvalidPasswordError</em></li>
<li>and <em>handleErrors</em> function provided to <em>useQuery</em>/<em>useMutation</em> hook</li>
</ul>
<p>All other error handling logic is excluded to an utility module and can be reused in all components.</p>
<p>And by using <em>UserInputErrorProperties</em> on both client and server side we gain type safety across the system - if any change in error’s <em>properties</em> object is made on either side and the change is not synchronized everywhere where the error is handled then during compilation Typescript will show places where source code needs update.</p>
<p>What if a component cannot handle errors imperatively and <em>canHandleErrors</em> function returns <em>false</em>? These errors have to be handled declaratively, let’s see how we can do that in the next section.</p>
<h2>2. Handling GraphQL errors declaratively</h2>
<p>For displaying a custom UI component when an error occurs we can use <em>error</em> object returned by <em>useQuery</em>/<em>useMutation</em> hook. In our example:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="10"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> [</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk12">updateUserEmail</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">    { </span><span class="mtk12">data</span><span class="mtk1">, </span><span class="mtk12">loading</span><span class="mtk1">, </span><span class="mtk12">error</span><span class="mtk1"> },</span></span>
<span class="grvsc-line"><span class="mtk1">  ] = </span><span class="mtk10">useUpdateUserEmailMutation</span><span class="mtk1">({</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk12">onError:</span><span class="mtk1"> </span><span class="mtk12">handleErrors</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  });</span></span></code></pre>
<p>Before displaying a fallback UI we have to check if the error has not been handled by <em>onError</em> handler. We can use previously defined <em>canHandleErrors</em> function for that:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="11"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">if</span><span class="mtk1"> (</span><span class="mtk12">error</span><span class="mtk1"> && !</span><span class="mtk10">canHandleErrors</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">, </span><span class="mtk12">errorProperties</span><span class="mtk1">)) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> &lt;</span><span class="mtk9">DefaultError</span><span class="mtk1"> </span><span class="mtk9">error</span><span class="mtk1">={</span><span class="mtk9">error</span><span class="mtk1">} /&gt;;</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span></code></pre>
<p>The error can contain various error codes, if we want to differentiate fallback UI based on an error code then it can be done internally in <em>DefaultError</em> component. For example if we want to:</p>
<ul>
<li>redirect to <em>SIGN_IN</em> route in case of error code <em>UNAUTHENTICATED</em></li>
<li>display a custom error message for other error codes</li>
</ul>
<p>then <em>DefaultError</em> component could look like this:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="12"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">doesIncludeErrorType</span><span class="mtk1">(</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">error</span><span class="mtk1">: </span><span class="mtk9">ApolloError</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk12">apolloErrorType</span><span class="mtk1">: </span><span class="mtk9">string</span><span class="mtk1">,</span></span>
<span class="grvsc-line"><span class="mtk1">): </span><span class="mtk9">boolean</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">result</span><span class="mtk1"> = </span><span class="mtk12">error</span><span class="mtk1">.</span><span class="mtk12">graphQLErrors</span><span class="mtk1">.</span><span class="mtk10">some</span><span class="mtk1">(</span><span class="mtk12">graphQLError</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">graphQLError</span><span class="mtk1">.</span><span class="mtk12">extensions</span><span class="mtk1">?.</span><span class="mtk12">code</span><span class="mtk1"> === </span><span class="mtk12">apolloErrorType</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  });</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">result</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">doesIncludeAuthenticationError</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">: </span><span class="mtk9">ApolloError</span><span class="mtk1">): </span><span class="mtk9">boolean</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">result</span><span class="mtk1"> = </span><span class="mtk10">doesIncludeErrorType</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">, </span><span class="mtk17">&quot;UNAUTHENTICATED&quot;</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">result</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">doesIncludeForbiddenError</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">: </span><span class="mtk9">ApolloError</span><span class="mtk1">): </span><span class="mtk9">boolean</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">result</span><span class="mtk1"> = </span><span class="mtk10">doesIncludeErrorType</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">, </span><span class="mtk17">&quot;FORBIDDEN&quot;</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">result</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">doesIncludeInternalServerError</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">: </span><span class="mtk9">ApolloError</span><span class="mtk1">): </span><span class="mtk9">boolean</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">const</span><span class="mtk1"> </span><span class="mtk12">result</span><span class="mtk1"> = </span><span class="mtk10">doesIncludeErrorType</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">, </span><span class="mtk17">&quot;INTERNAL_SERVER_ERROR&quot;</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk12">result</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span>
<span class="grvsc-line"></span>
<span class="grvsc-line"><span class="mtk14">export</span><span class="mtk1"> </span><span class="mtk4">function</span><span class="mtk1"> </span><span class="mtk10">DefaultError</span><span class="mtk1">(</span><span class="mtk12">props</span><span class="mtk1">: { </span><span class="mtk12">error</span><span class="mtk1">: </span><span class="mtk9">ApolloError</span><span class="mtk1"> }) {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk14">if</span><span class="mtk1"> (</span><span class="mtk12">props</span><span class="mtk1">.</span><span class="mtk12">error</span><span class="mtk1">.</span><span class="mtk12">networkError</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> &lt;</span><span class="mtk9">NetworkError</span><span class="mtk1"> /&gt;;</span></span>
<span class="grvsc-line"><span class="mtk1">  } </span><span class="mtk14">else</span><span class="mtk1"> </span><span class="mtk14">if</span><span class="mtk1"> (</span><span class="mtk10">doesIncludeAuthenticationError</span><span class="mtk1">(</span><span class="mtk12">props</span><span class="mtk1">.</span><span class="mtk12">error</span><span class="mtk1">)) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> &lt;</span><span class="mtk9">Redirect</span><span class="mtk1"> </span><span class="mtk9">to</span><span class="mtk1">={</span><span class="mtk9">routePaths</span><span class="mtk1">.</span><span class="mtk9">SIGN_IN</span><span class="mtk1">} /&gt;;</span></span>
<span class="grvsc-line"><span class="mtk1">  } </span><span class="mtk14">else</span><span class="mtk1"> </span><span class="mtk14">if</span><span class="mtk1"> (</span><span class="mtk10">doesIncludeForbiddenError</span><span class="mtk1">(</span><span class="mtk12">props</span><span class="mtk1">.</span><span class="mtk12">error</span><span class="mtk1">)) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> &lt;</span><span class="mtk9">ForbiddenError</span><span class="mtk1"> /&gt;;</span></span>
<span class="grvsc-line"><span class="mtk1">  } </span><span class="mtk14">else</span><span class="mtk1"> </span><span class="mtk14">if</span><span class="mtk1"> (</span><span class="mtk10">doesIncludeInternalServerError</span><span class="mtk1">(</span><span class="mtk12">props</span><span class="mtk1">.</span><span class="mtk12">error</span><span class="mtk1">)) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> &lt;</span><span class="mtk9">InternalServerError</span><span class="mtk1"> /&gt;;</span></span>
<span class="grvsc-line"><span class="mtk1">  } </span><span class="mtk14">else</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> &lt;</span><span class="mtk9">UnknownError</span><span class="mtk1"> /&gt;;</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span></code></pre>
<p>With this setup to every component that might experience errors we have to import only <em>DefaultError</em> component.</p>
<p>In the last section let’s see how non-GraphQL errors can be handled.</p>
<h2>3. Handling non-GraphQL errors</h2>
<p>While not a main subject of this post, for completeness let’s shortly cover how to handle other, non-GraphQL-related errors. We can also divide them into two categories: errors thrown in UI and errors thrown in imperative code.</p>
<p>For handling the first category of errors React provides <a href="https://reactjs.org/docs/error-boundaries.html">error boundaries</a> that allow to catch errors in their child components, log errors and display a fallback UI. To provide higher granularity error boundaries can be nested, in such a case an error will be caught by the error boundary that is the closest parent of the component that generated an error. An error boundary can look like this:</p>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="13"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk14">export</span><span class="mtk1"> </span><span class="mtk4">class</span><span class="mtk1"> </span><span class="mtk9">ErrorBoundary</span><span class="mtk1"> </span><span class="mtk4">extends</span><span class="mtk1"> </span><span class="mtk9">React</span><span class="mtk1">.</span><span class="mtk9">Component</span><span class="mtk1">&lt;{}, { </span><span class="mtk12">hasError</span><span class="mtk1">: </span><span class="mtk9">boolean</span><span class="mtk1"> }&gt; {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">constructor</span><span class="mtk1">(</span><span class="mtk12">props</span><span class="mtk1">: {}) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk4">super</span><span class="mtk1">(</span><span class="mtk12">props</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">state</span><span class="mtk1"> = { </span><span class="mtk12">hasError:</span><span class="mtk1"> </span><span class="mtk4">false</span><span class="mtk1"> };</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk4">static</span><span class="mtk1"> </span><span class="mtk10">getDerivedStateFromError</span><span class="mtk1">() {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk3">// Update state so the next render will show the fallback UI:</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> { </span><span class="mtk12">hasError:</span><span class="mtk1"> </span><span class="mtk4">true</span><span class="mtk1"> };</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">componentDidCatch</span><span class="mtk1">(</span><span class="mtk12">error</span><span class="mtk1">: </span><span class="mtk9">Error</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk12">logger</span><span class="mtk1">.</span><span class="mtk10">error</span><span class="mtk1">(</span><span class="mtk12">functionPath</span><span class="mtk1">, </span><span class="mtk17">`error: </span><span class="mtk4">${</span><span class="mtk9">JSON</span><span class="mtk18">.</span><span class="mtk10">stringify</span><span class="mtk18">(</span><span class="mtk12">error</span><span class="mtk18">)</span><span class="mtk4">}</span><span class="mtk17">`</span><span class="mtk1">);</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk10">render</span><span class="mtk1">() {</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">if</span><span class="mtk1"> (</span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">state</span><span class="mtk1">.</span><span class="mtk12">hasError</span><span class="mtk1">) {</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk3">// Render fallback UI:</span></span>
<span class="grvsc-line"><span class="mtk1">      </span><span class="mtk14">return</span><span class="mtk1"> &lt;</span><span class="mtk9">UnknownError</span><span class="mtk1"> /&gt;;</span></span>
<span class="grvsc-line"><span class="mtk1">    }</span></span>
<span class="grvsc-line"><span class="mtk1">    </span><span class="mtk14">return</span><span class="mtk1"> </span><span class="mtk4">this</span><span class="mtk1">.</span><span class="mtk12">props</span><span class="mtk1">.</span><span class="mtk12">children</span><span class="mtk1">;</span></span>
<span class="grvsc-line"><span class="mtk1">  }</span></span>
<span class="grvsc-line"><span class="mtk1">}</span></span></code></pre>
<p>In case of errors in imperative code:</p>
<ul>
<li>for synchronous code we can handle them by simply surrounding places where they may occur with regular try/catch block,</li>
<li>for asynchronous code we can also use try/catch block with async/await construct or we can register error handling callback either using <em>catch</em> method or as a second argument to <em>then</em> method at the end of promises’ chain. As a last resort, global event handler can be added for <em>unhandledrejection</em> event in one of the following ways:</li>
</ul>
<pre class="grvsc-container grvsc-container-additional light-default-light" data-language="typescript" data-index="14"><code class="grvsc-code"><span class="grvsc-line"><span class="mtk12">window</span><span class="mtk1">.</span><span class="mtk10">addEventListener</span><span class="mtk1">(</span><span class="mtk17">&quot;unhandledrejection&quot;</span><span class="mtk1">, </span><span class="mtk12">event</span><span class="mtk1"> </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk3">// handle event here</span></span>
<span class="grvsc-line"><span class="mtk1">});</span></span>
<span class="grvsc-line"><span class="mtk12">window</span><span class="mtk1">.</span><span class="mtk10">onunhandledrejection</span><span class="mtk1"> = (</span><span class="mtk12">event</span><span class="mtk1">: </span><span class="mtk9">PromiseRejectionEvent</span><span class="mtk1">) </span><span class="mtk4">=&gt;</span><span class="mtk1"> {</span></span>
<span class="grvsc-line"><span class="mtk1">  </span><span class="mtk3">// handle event here</span></span>
<span class="grvsc-line"><span class="mtk1">};</span></span></code></pre>
<h3>Summary</h3>
<p>Let’s summarize, as a result of implemented changes the client application properly handles GraphQL and non-GraphQL errors, in component and global scope, in imperative and declarative way. And although errors are not part of GraphQL schema, by sharing error types between server and client the system obtained type safety also in error handling area.</p>
<style class="grvsc-styles">
  :root {
    --grvsc-padding-v: 1rem;
    --grvsc-padding-h: 1.5rem;
    --grvsc-padding-top: var(--grvsc-padding-v);
    --grvsc-padding-right: var(--grvsc-padding-h);
    --grvsc-padding-bottom: var(--grvsc-padding-v);
    --grvsc-padding-left: var(--grvsc-padding-h);
    --grvsc-border-radius: 8px;
  
    --grvsc-line-highlighted-background-color: transparent;
    --grvsc-line-highlighted-border-width: 4px;
    --grvsc-line-highlighted-border-color: transparent;
  }
  
  .grvsc-container {
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top);
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom);
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius);
    font-feature-settings: normal;
  }
  
  .grvsc-code {
    display: inline-block;
    min-width: 100%;
  }
  
  .grvsc-line {
    display: inline-block;
    box-sizing: border-box;
    width: 100%;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left);
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right);
  }
  
  .grvsc-line-highlighted {
    background-color: var(--grvsc-line-highlighted-background-color);
    box-shadow: inset var(--grvsc-line-highlighted-border-width) 0 0 0 var(--grvsc-line-highlighted-border-color);
  }
  
  .light-default-light {
    background-color: #FFFFFF;
    color: #000000;
  }
  .light-default-light .mtk14 { color: #AF00DB; }
  .light-default-light .mtk1 { color: #000000; }
  .light-default-light .mtk4 { color: #0000FF; }
  .light-default-light .mtk12 { color: #001080; }
  .light-default-light .mtk9 { color: #267F99; }
  .light-default-light .mtk10 { color: #795E26; }
  .light-default-light .mtk3 { color: #008000; }
  .light-default-light .mtk17 { color: #A31515; }
  .light-default-light .mtk7 { color: #09885A; }
  .light-default-light .mtk18 { color: #000000FF; }
</style></div><hr class="blog-post__Divider-eho2rb-1 jvjEUU"/><ul class="blog-post__PostNavigator-eho2rb-3 dHdzzE"><li><a rel="prev" href="/blog/error-handling-with-apollo-server/">← <!-- -->Error handling with Apollo Server</a></li><li></li></ul></main><footer>© <!-- -->2020<!-- -->, blog by Tomek Fojtuch, built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/error-handling-with-apollo-client/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-8ed3204e5c27ae2d5728.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-ceef87afc058962c4db9.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx-52cdd10a98d92531f1e9.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-a13e585e93a0e2212c24.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-40283c6c1a0b22ad1b40.js"]};/*]]>*/</script><script src="/blog/webpack-runtime-c97ca491c02a36b48a90.js" async=""></script><script src="/blog/styles-e4a06a68ee395de1b9be.js" async=""></script><script src="/blog/app-8ed3204e5c27ae2d5728.js" async=""></script><script src="/blog/commons-4c5a16b1316207ebaf0f.js" async=""></script><script src="/blog/component---src-templates-blog-post-tsx-52cdd10a98d92531f1e9.js" async=""></script></body></html>